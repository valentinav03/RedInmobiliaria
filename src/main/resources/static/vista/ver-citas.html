<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Gestión de Citas</title>
  <style>
    :root {
      --primary: #8D7B68;
      --secondary: #A4907C;
      --accent: #C8B6A6;
      --light: #F1DEC9;
      --dark: #4D4639;
      --error: #A94442;
      --success: #3C763D;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: var(--light);
      color: var(--dark);
      margin: 0;
      padding: 20px;
    }

    h1 {
      color: var(--primary);
      text-align: center;
    }

    button {
      background-color: var(--primary);
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      margin-right: 10px;
    }

    button:hover {
      background-color: var(--secondary);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background-color: white;
    }

    th, td {
      border: 1px solid var(--accent);
      padding: 10px;
      text-align: left;
    }

    th {
      background-color: var(--accent);
      color: var(--dark);
    }

    #formularioCita {
      background-color: white;
      padding: 20px;
      border: 1px solid var(--accent);
      border-radius: 5px;
      margin-top: 20px;
      display: none;
    }

    label {
      display: block;
      margin-bottom: 10px;
    }

    input, select {
      width: 100%;
      padding: 8px;
      margin-top: 4px;
      border: 1px solid var(--accent);
      border-radius: 4px;
    }

    form button[type="submit"] {
      background-color: var(--success);
    }

    form button[type="button"] {
      background-color: var(--error);
    }

    form button[type="submit"]:hover {
      background-color: #2e5e2c;
    }

    form button[type="button"]:hover {
      background-color: #7d1f1b;
    }

    h1 {
      color: var(--primary);
      text-align: center;
      margin-left: 180px;

    }
  </style>
</head>
<link rel="stylesheet" href="../Estilos/styles.css">
<link rel="stylesheet" href="../Estilos/dashboard.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<h1>Mis Citas Agendadas</h1>

<body>

  <div class="dashboard-container">
    <!-- Sidebar de navegación -->
    <div class="sidebar">
        <div class="sidebar-header">
            <i class="fas fa-building"></i>
            <h3>Red Inmobiliaria</h3>
        </div>
        
        <div class="user-info">
            <div class="user-avatar">
                <i class="fas fa-user-circle"></i>
            </div>
            <div class="user-details">
                <h4 id="user-name"></h4>
                <span id="user-role"></span>
            </div>
        </div>
        
        <ul class="sidebar-menu">
            <li class="active"><a href="dashboard.html"><i class="fas fa-home"></i> Panel Principal</a></li>
            <li><a href="administracion.html"><i class="fas fa-list"></i>Administración de propiedades</a></li>
            <li><a href="ver-citas.html"><i class="fas fa-calendar"></i> Citas</a></li>
            <li><a href="ImagenPropiedad.html"><i class="fas fa-edit"></i>Edición de imágenes</a></li>
            <li><a href="usuario.html"><i class="fas fa-user"></i> Mi Perfil</a></li>
            <li class="logout"><a href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Cerrar Sesión</a></li>
        </ul>
    </div>

  <table>

    <thead>
      
      <tr>
        <th>ID</th>
        <th>Propiedad</th>
        <th>Dirección</th>
        <th>Fecha y Hora</th>
        <th>Estado</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody id="tablaCitas"></tbody>
  </table>

  <script>
    const API_CITAS = 'http://localhost:8094/api/citas/list';

    document.addEventListener("DOMContentLoaded", function () {
      const userData = JSON.parse(localStorage.getItem("user"));
      const idCliente = userData?.id;

      if (!idCliente) {
        alert("Usuario no identificado");
        return;
      }

      fetch(`http://localhost:8094/api/citas/list`)
        .then(res => res.json())
        .then(citas => {
          const tabla = document.getElementById("tablaCitas");
          tabla.innerHTML = "";
          citas.forEach(cita => {
            tabla.innerHTML += `
              <tr>
                <td>${cita.id}</td>
                <td>${cita.idPropiedad?.idPropiedad}</td>
                <td>${cita.idPropiedad?.direccion || 'N/D'}</td>
                <td>${new Date(cita.fechaHora).toLocaleString()}</td>
                <td>${cita.idEstado?.nombre || 'Pendiente'}</td>
                <td>
                  <button onclick="editarCita(${cita.id})">Editar</button>
                  <button onclick="eliminarCita(${cita.id})">Eliminar</button>
                </td>
              </tr>`;
          });
        })
        .catch(err => {
          console.error("Error cargando citas:", err);
          alert("No se pudieron cargar las citas");
        });
    });


    function eliminarCita(id) {
      if (confirm("¿Estás seguro de que deseas eliminar esta cita?")) {
        fetch(`http://localhost:8094/api/citas/${id}`, {
          method: 'DELETE'
        })
        .then(res => {
          if (res.ok) {
            alert("Cita eliminada");
            location.reload();
          } else {
            throw new Error("Error al eliminar la cita");
          }
        })
        .catch(err => {
          console.error("Error al eliminar cita:", err);
          alert("No se pudo eliminar la cita");
        });
      }
    }
  </script>
</body>
</html>
